---
- name: configure access ports
  ios_l2_interfaces:
    config:
      - name: "{{ item.0.id }}"
        access:
          vlan: "{{ item.1.vlan }}"
  loop: "{{ interfaces|subelements('access', skip_missing=True) }}"
- name: stp protection on access ports
  ios_config:
    parents: interface {{ item.0.id }}
    lines:
      - spanning-tree portfast
      - spanning-tree bpduguard enable
  loop: "{{ interfaces|subelements('access', skip_missing=True) }}"
